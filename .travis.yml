language: python
dist: xenial
python:
- '2.7'
- '3.6'
cache: pip
matrix:
  allow_failures:
  - python: '2.7'
env:
  global:
    secure: Y5j85mZkKueWncA78MCDBDdzp8gKrK+WUU7YCmzfUWIgyqgwgrEAZRe7urojiX/+7iwa9MZA8H9xwNNt9ERAkyizEwMPfeU12mGlj2PCwTRfK2AwGwtdzvsBgxDmmCk1BxtvKXjIvx68XYOT1GAX1n3eyv9H+wD0ljB6tMYUxubNKbJ/fn8eGB3EVksHRb/lwOcLQUmQGJhUSF4oBq6mMZyQjBlKvuVMzHLsYL/kOEu2eqpTPMVA8NGMrWyo4NGiqX7WWv/kncUmVz66uWBZsDVZ1rXKZfunRxpbgJlmHAAL7WakHhTnB3+nQx5KoBkEhk0feP7tpD1c/c3mz6xKjAsnDIa501WcyyOi/OGd8pjXa/kUv0A4qIS5fWVjCdpCKpq30NfGrkdD6CPrrFw/igr2y+EMicYDQ5gaXbuaaM12ctqYqh4kuHnKOIHuSdhHB1AbKpORfdEdTdD2Ufcdd7F1kWYZL1bFKqD4u6O57b58/nkstFAA2vyyvdXHm0oGzk076019gIWEwHzlmKjrzLXCpkVcdzarq9HJcAT+6Bvi+2eYOKjssA/NLHvETYlGis3n3FZcNnHLjfPBmFc+6xCFu7FMCibj0II5NwDugup968Xp0dxbhAlP0UFCrS4V/hHvnd9TmCLZUp/HGOmRsKwsubykqXyYYKvr5CGMCDs=
install:
- pip uninstall -y userdatamodel || true
- curl -sSL https://raw.githubusercontent.com/python-poetry/poetry/master/get-poetry.py | python
- $HOME/.poetry/bin/poetry install -E flask
script:
- $HOME/.poetry/bin/poetry run py.test -vv --cov=src --cov-report xml tests
after_script:
- pip install codacy-coverage
- python-codacy-coverage -r coverage.xml
deploy:
  provider: pypi
  user: uc-ctds
  skip_cleanup: true
  skip_existing: true
  on:
    tags: true
  password:
    secure: hvwCa8dDh4bpBDXghJcVnONBGGtF9nl/d+y37EI9pUzuTRkBLe+CaRkOnoiB6s+TzvcSmoxDpCsd2QlR3ZKZudmSoScBhoaEq5uheoK9/tstgubsXokC6gThXmrcmxRn3VzovvQ31SdDb/aKyGYnkTdR2wxS9KNnun4QkHETPsBUz+alASj8UTEw8k+7e5Zhq4xEs5AJ2YXu2PPKZatvMMFIQzvc3A2I65M2yu+tUtxGdna5/TAzh1vMfwaIOxb+Cp+2ALuZscot5NpHZl1KM3sNNEFN6Ys929GQNXSxKXSv7V/zywvuyGi7O5bU3VArvnLKXSk/+33c8L++If+Y2SKwPExQOvawytwM2vjmtu0EAqc96G8vBPF+Yoo2ZbuvdIOwJJQ0GTvL6LZvdoO/zK/D9QyQRyFUbC0UeiXy/qtj22ehuExNS/OlT4hgcsX1+nVrlw+tclGhGM4TNXkTXeqXF84M3eIEvtovj6GQ6SBVOCNqjao4IVvXa/OtinvD9J4/Xk7rGNm/JJiq/zl5xzj09nS3z4Re/3FGYw2AxA4/D1Jvs8jCR8dSWL63Jjr2T9GyOgluWIw8tnu2p0YTxiBE3Tx2+TXNvFsGg/m8lM9NIiuMM3riF1XGfkCFGLdhfuziFaygZAzkm50LxjTc3vw9mlu2k0wvP985mrV3zr4=
after_deploy:
- "./release_notes.sh"
